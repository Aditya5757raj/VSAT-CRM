<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VSAT CRM - Dashboard</title>
  <link rel="stylesheet" href="../css/dashboard.css">
  <link rel="stylesheet" href="../css/warehouse.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  
</head>

<body>
  <!-- Page Transition -->
    <div class="page-transition" id="pageTransition"></div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" style="width: 250px; background-color: #f4f4f4; height: 100vh;">
      <div class="sidebar-header" style="padding: 20px; overflow: visible;">
        <div class="logo" style="display: flex; align-items: center; gap: 16px; max-width: 100%;">
          <img src="../assets/logo1.png" alt="VSAT Logo"
            style="height: 80px; width: 80px; object-fit: contain; border-radius: 8px; background-color: white; padding: 6px;">
          <div class="logo-text" style="line-height: 1.2;">
            <h1 style="font-size: 20px; margin: 0; color: #0d47a1;">VSAT CRM</h1>
            <p style="font-size: 13px; margin: 4px 0 0; color: #444;">Warehouse Dashboard</p>
          </div>
        </div>
      </div>

      <!-- Navigation Menu -->
      <nav class="sidebar-nav" style="padding: 0 20px;">
        <div class="nav-section">
          <p class="nav-title" style="margin: 10px 0; font-weight: bold;">Main Menu</p>
          <ul class="nav-list" style="list-style: none; padding: 0;">
            <li>
              <button class="nav-item active" data-section="po-status">
                <i class="fas fa-list-alt"></i> Dashboard
              </button>
            </li>
            <li>
                <button class="nav-item" data-section="grm">
                    <i class="fas fa-clipboard-check"></i> GRM
                </button>
            </li>
          </ul>
        </div>
        <div class="nav-section">
                    <p class="nav-title" style="margin: 10px 0; font-weight: bold;">Settings</p>
                    <ul class="nav-list" style="list-style: none; padding: 0;">
                        <!-- <li>
                            <button class="nav-item" data-section="preferences">
                                <i class="fas fa-cog"></i> Preferences
                            </button>
                        </li> -->
                        <li>
                            <button class="nav-item" data-section="user-management">
                                <i class="fas fa-users"></i> User Management
                            </button>
                        </li>
                    </ul>
                </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
          </button>
          <h2>Customer Service Portal</h2>
        </div>
        <div class="header-right">
          <button class="refresh-btn" id="headerRefreshBtn" title="Refresh Dashboard">
            <i class="fas fa-sync-alt"></i>
          </button>
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search customers, jobs...">
          </div>
          <button class="notification-btn">
            <i class="fas fa-bell"></i>
          </button>
          <div class="user-profile">
            <div class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">JD</div>
            <div class="user-info">
              <div class="user-name" id="userName">Loading...</div>
              <div class="user-role" id="userRole">Loading...</div>
            </div>

            <!-- User Dropdown Menu -->
            <div class="user-dropdown" id="userDropdown">
              <div class="dropdown-item" id="changePasswordBtn">
                <i class="fas fa-key"></i>
                <span>Change Password</span>
              </div>
              <div class="dropdown-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
              </div>
            </div>
          </div>
        </div>
      </header>

  <!-- Content Area -->
  <main class="content">

      <!-- PO Status Section -->
                <section id="po-status" class="section active">
                    <div class="section-header">
                        <h2><i class="fas fa-list-alt"></i> Purchase Order Status</h2>
                        <p>Track and manage purchase order status</p>
                    </div>

                    <!-- Status Filter Tabs -->
                    <div class="card">
                        <div class="card-header">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3>Filter by Status</h3>
                                <div class="job-status-tabs">
                                    <button class="tab-btn active" data-status="pending">Pending</button>
                                    <button class="tab-btn" data-status="dispatched">Dispatched</button>
                                    <button class="tab-btn" data-status="delivered">Delivered</button>
                                    <button class="tab-btn" data-status="cancelled">Cancelled</button>
                                </div>
                            </div>
                        </div>

                        <!-- PO Status Table -->
                        <div class="results-section" id="poStatusSection">
                            <div class="card" id="poStatusResultCard" style="display: none;">
                                <div class="card-body">
                                    <div id="poStatusLoadingIndicator" class="loading-indicator" style="display: none;">
                                        <i class="fas fa-spinner fa-spin"></i> Loading purchase orders...
                                    </div>

                                    <!-- PO Status Table -->
                                    <div class="table-container" id="poStatusTableContainer">
                                        <table class="jobs-table" id="poStatusTable">
                                            <thead>
                                                <tr>
                                                    <th>PO Number</th>
                                                    <th>Model Number</th>
                                                    <th>Part Code</th>
                                                    <th>Complaint ID</th>
                                                    <th>Quantity</th>
                                                    <th>Status</th>
                                                    <th>Created Date</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="poStatusTableBody">
                                                <!-- Dynamic content will be inserted here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                </section>


<!-- GRM Section -->
<section id="grm" class="section">
  <div class="section-header">
    <h2><i class="fas fa-shipping-fast"></i> Goods Receipt Management</h2>
    <p>Manage dispatched orders and goods receipt</p>
  </div>

  <div class="results-section">
    <div class="card">
      <div class="card-header">
        <h3>Dispatched Orders</h3>
      </div>
      <div class="card-body">
        <div id="grmLoadingIndicator" class="loading-indicator" style="display: none;">
          <i class="fas fa-spinner fa-spin"></i> Loading dispatched orders...
        </div>

        <div class="table-container">
          <table class="jobs-table">
            <thead>
              <tr>
                <th>PO Number</th>
                <th>Model Number</th>
                <th>Part Code</th>
                <th>Quantity</th>
                <th>Docket Name</th>
                <th>Courier</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="grmTableBody">
              <!-- Dynamic GRM content inserted by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Settings Sections (Placeholder) -->
                <div id="preferences" class="section">
                    <div class="section-header">
                        <h3>Preferences</h3>
                        <p>Manage your application preferences and settings</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p style="text-align: center; color: #64748b; padding: 40px;">
                                <i class="fas fa-cog" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                                Preferences settings will be implemented here.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- User Management Section -->
                <div id="user-management" class="section">
                    <div class="section-header">
                        <h3>User Management</h3>
                        <p>Manage user accounts and permissions</p>
                    </div>

                    <!-- Centering wrapper -->
                    <div class="form-center-wrapper">
                        <div class="card">
                            <div class="card-header" style="text-align: center;">
                                <h4 style="margin: 0;">Change Password</h4>
                            </div>

                            <div class="card-content">
                                <form id="passwordChangeForm" onsubmit="return false;">
                                    <div class="form-group">
                                        <label for="username">Username</label>
                                        <input type="text" id="username" class="form-input" required />
                                    </div>

                                    <div class="form-group password-group">
                                        <label for="oldPassword">Old Password</label>
                                        <input type="password" id="oldPassword" class="form-input" required />
                                        <span class="toggle-icon" onclick="togglePassword('oldPassword', this)">
                                            <i class="fas fa-eye"></i>
                                        </span>
                                    </div>

                                    <div class="form-group password-group">
                                        <label for="newPassword">New Password</label>
                                        <input type="password" id="newPassword" class="form-input" required />
                                        <span class="toggle-icon" onclick="togglePassword('newPassword', this)">
                                            <i class="fas fa-eye"></i>
                                        </span>
                                        <small id="passwordSameError" class="error-message">❌ New password must be
                                            different from old password.</small>

                                    </div>

                                    <div class="form-group password-group">
                                        <label for="confirmPassword">Confirm New Password</label>
                                        <input type="password" id="confirmPassword" class="form-input" required />
                                        <span class="toggle-icon" onclick="togglePassword('confirmPassword', this)">
                                            <i class="fas fa-eye"></i>
                                        </span>
                                        <small id="passwordError" class="error-message">❌ Passwords do not
                                            match.</small>
                                        <small id="passwordSuccess" class="success-message">✅ Passwords match.</small>
                                    </div>

                                    <button type="submit" class="submit-button" onclick="submitPasswordChange()">Change
                                        Password</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

    </main>
  </div>
</div>


 <!-- View PO Details Modal -->
    <div id="viewPoModal" class="custom-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h2>Purchase Order Details</h2>
                <button class="custom-modal-close" onclick="closeViewPoModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="custom-modal-body">
                <div class="details-grid">

                    <!-- Basic Info -->
                    <div class="detail-section">
                        <h3>Basic Information</h3>
                        <div class="detail-row"><label>PO Number:</label><span id="viewPoNumber">-</span></div>
                        <div class="detail-row"><label>Model Number:</label><span id="viewModelNumber">-</span></div>
                        <div class="detail-row"><label>Part Code:</label><span id="viewPartCode">-</span></div>
                        <div class="detail-row"><label>Complaint ID:</label><span id="viewComplaintId">-</span></div>
                    </div>

                    <!-- Quantity -->
                    <div class="detail-section">
                        <h3>Quantity</h3>
                        <div class="detail-row"><label>Requested Quantity:</label><span
                                id="viewRequestedQuantity">-</span></div>
                        <div class="detail-row"><label>Status:</label><span id="viewStatus">-</span></div>
                    </div>

                    <!-- Dates -->
                    <div class="detail-section">
                        <h3>Dates</h3>
                        <div class="detail-row"><label>Created Date:</label><span id="viewCreatedDate">-</span></div>
                    </div>

                    <!-- Courier -->
                    <div class="detail-section">
                        <h3>Courier Details</h3>
                        <div class="detail-row"><label>Docket Name:</label><span id="viewDocketName">-</span></div>
                        <div class="detail-row"><label>Courier Name:</label><span id="viewCourierName">-</span></div>
                        <div class="detail-row"><label>Received Status:</label><span id="viewReceivedStatus">-</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

<!-- Edit PO Modal -->
<div id="editPOModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> Edit Purchase Order</h3>
    <button class="modal-close" onclick="closeEditPOModal()">&times;</button>
    </div>
    <div class="modal-body">
    <form id="editPOForm">
      <div class="form-grid">
      <div class="form-group">
      <label>Docket Name</label>
      <input type="text" id="editDocketName" />
      </div>

      <div class="form-group">
      <label>Courier Name</label>
      <input type="text" id="editCourierName" />
      </div>

      <div class="form-group">
      <label>Received Status</label>
      <select id="editReceivedStatus">
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>
      </div>
      </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary" onclick="saveEditedPO()">
        <i class="fas fa-save"></i> Save Changes
      </button>
      <button class="btn btn-outline" onclick="closeEditPOModal()">Cancel</button>
    </div>
  </div>
</div>



<!-- GRM Edit Modal -->
<div id="editGrmModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> Edit GRM Order</h3>
      <button class="modal-close" onclick="closeEditGrmModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form id="editGrmForm">
        <div class="form-grid">
          <div class="form-group">
            <label>PO Number</label>
            <input type="text" id="editGrmPoNumber" readonly />
          </div>
          <div class="form-group">
            <label>Model Number</label>
            <input type="text" id="editGrmModelNumber" readonly />
          </div>
          <div class="form-group">
            <label>Part Code</label>
            <input type="text" id="editGrmPartCode" readonly />
          </div>
          <div class="form-group">
            <label>Requested Quantity</label>
            <input type="text" id="editGrmRequestedQuantity" readonly />
          </div>
          <div class="form-group">
            <label>Received Status</label>
            <select id="editGrmReceivedStatus">
              <option value="received_ok">Received OK</option>
              <option value="received_short">Received Short</option>
              <option value="excess">Excess</option>
              <option value="received_defective">Received Defective</option>
            </select>
          </div>
          <div class="form-group" id="shortQuantityGroup" style="display: none;">
            <label>Short Quantity</label>
            <input type="number" id="editShortQuantity" placeholder="Enter short quantity" min="0">
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="saveGrmChanges()">
        <i class="fas fa-save"></i> Save Changes
      </button>
      <button class="btn btn-outline" onclick="closeEditGrmModal()">Cancel</button>
    </div>
  </div>
</div>


<script>
  window.onload = function () {
    // Clear active state from all sections
    document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));

    // Set default section active
    const poStatusSection = document.getElementById('po-status');
    if (poStatusSection) {
        poStatusSection.classList.add('active');
    }

    // Set the corresponding nav-item active
    const defaultNavItem = document.querySelector('.nav-item[data-section="po-status"]');
    if (defaultNavItem) {
        defaultNavItem.classList.add('active');
    }

    // Ensure loadPOStatus runs after full page is loaded
    if (typeof loadPOStatus === 'function') {
        console.log('✅ Loading pending PO data by default');
        loadPOStatus('pending');
    }

    // Initialize nav-item click listeners
    document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', function () {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));

            this.classList.add('active');
            const sectionId = this.getAttribute('data-section');
            const section = document.getElementById(sectionId);
            if (section) section.classList.add('active');

            if (sectionId === 'po-status' && typeof loadPOStatus === 'function') {
                loadPOStatus('pending');
            }
            if (sectionId === 'grm' && typeof loadGrmData === 'function') {
                loadGrmData();
            }
        });
    });
};


</script>

  <!-- Toast Notification Container -->
  <div id="toastContainer"></div>

  <!-- Mobile Navigation Toggle -->
  <script src="../js/Config.js"></script>
  <script src="../js/dashboard.js"></script>
  <!-- <script src="../js/inventory.js"></script> -->
  <script src="../js/warehouse_user.js"></script>
</body>

</html>
